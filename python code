import json
def arcgis_to_geojson(arcgis_json, layer_name="Layer"):
    """
    Convert ArcGIS JSON format to GeoJSON format.
    
    Parameters:
        arcgis_json (dict): ArcGIS JSON object
        layer_name (str): Name of the GeoJSON layer
    
    Returns:
        dict: GeoJSON FeatureCollection
    """
    
    # Map ArcGIS geometry types to GeoJSON types
    geometry_map = {
        "esriGeometryPoint": "Point",
        "esriGeometryPolyline": "LineString",
        "esriGeometryPolygon": "Polygon",
        "esriGeometryMultipoint": "MultiPoint"
    }
    
    geojson = {
        "type": "FeatureCollection",
        "name": layer_name,
        "features": []
    }
    
    geometry_type = arcgis_json.get("geometryType")
    geo_type = geometry_map.get(geometry_type, "Geometry")
    
    for feature in arcgis_json.get("features", []):
        properties = feature.get("attributes", {})
        geometry = feature.get("geometry", {})
        
        # Handle different geometry types
        if geometry_type == "esriGeometryPolygon":
            coordinates = geometry.get("rings", [])
        elif geometry_type == "esriGeometryPolyline":
            coordinates = geometry.get("paths", [])
        elif geometry_type == "esriGeometryPoint":
            coordinates = [geometry.get("x"), geometry.get("y")]
        elif geometry_type == "esriGeometryMultipoint":
            coordinates = geometry.get("points", [])
        else:
            coordinates = []
        
        geojson_feature = {
            "type": "Feature",
            "properties": properties,
            "geometry": {
                "type": geo_type,
                "coordinates": coordinates
            }
        }
        
        geojson["features"].append(geojson_feature)
    
    return geojson

if __name__ == "__main__":
    # Load ArcGIS JSON (replace with your actual JSON file or dict)
    with open("data/LULC.json", "r") as f:       # or ("input/LULC.json", "r") based on the name of folder you have saved JSON data
        arcgis_data = json.load(f)
    # Set layer name
    geojson_data = arcgis_to_geojson(arcgis_data, layer_name="LULC")

     # Save to GeoJSON file
    with open("result/LULC.geojson", "w") as f:          # or ("output/LULC.json", "r") based on the name of folder you want to save GeoJSON data
        json.dump(geojson_data, f, indent=2)
    
    print("Conversion complete!")
    
    # âœ… Print instead of saving
    print(json.dumps(geojson_data, indent=1))
